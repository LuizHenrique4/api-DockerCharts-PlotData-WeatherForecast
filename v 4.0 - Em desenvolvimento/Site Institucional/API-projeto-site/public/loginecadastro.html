<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	<link rel="stylesheet" href="./css/style.css">

	<title>Login/Cadastro - OverWatch</title>
</head>

<body>

	<div class="container" id="container">
		<div class="form-container sign-up-container">
			<form action="#" class="ca-cadastro" id="form_cadastro" method="post" onsubmit="return cadastrar()">
				<br>
				<br>
				<br>
				<br>
				<br><br>
				<br>
				<br>
				<br>
				<br>
				<h1>Cadastro</h1>
				<input id="nomeEmpresa" name="nomeEmpresa" type="text" placeholder="Nome da empresa" required
					maxlength="45" />
				<input id="cnpjEmpresa" name="cnpjEmpresa" type="text" placeholder="CNPJ" required minlength="20" maxlength="20"/>
				<input id="emailEmpresa" name="emailEmpresa" type="email" placeholder="Email" required maxlength="45" />
				<input id="telefoneEmpresa" name="telefoneEmpresa" type="text" placeholder="Telefone" required
					minlength="11" maxlength="13"  />
				<input id="cep" name="cep" type="text" placeholder="CEP" required minlength="9" maxlength="9"/>
				<input id="bairro" name="bairro" type="text" placeholder="Bairro"/>
				<input id="complemento" name="complemento" type="text" placeholder="Complemento" />
				<input id="logradouro" name="logradouro" type="text" placeholder="Logradouro" />
				<input id="numero" name="numero" type="number" placeholder="Número"/>
				<select name="uf">
					<option value="-">Estado</option>
					<option value="AC">Acre</option>
					<option value="AL">Alagoas</option>
					<option value="AP">Amapá</option>
					<option value="AM">Amazonas</option>
					<option value="BA">Bahia</option>
					<option value="CE">Ceará</option>
					<option value="DF">Distrito Federal</option>
					<option value="ES">Espírito Santo</option>
					<option value="GO">Goiás</option>
					<option value="MA">Maranhão</option>
					<option value="MT">Mato Grosso</option>
					<option value="MS">Mato Grosso do Sul</option>
					<option value="MG">Minas Gerais</option>
					<option value="PA">Pará</option>
					<option value="PB">Paraíba</option>
					<option value="PR">Paraná</option>
					<option value="PE">Pernambuco</option>
					<option value="PI">Piauí</option>
					<option value="RJ">Rio de Janeiro</option>
					<option value="RN">Rio Grande do Norte</option>
					<option value="RS">Rio Grande do Sul</option>
					<option value="RO">Rondônia</option>
					<option value="RR">Roraima</option>
					<option value="SC">Santa Catarina</option>
					<option value="SP">São Paulo</option>
					<option value="SE">Sergipe</option>
					<option value="TO">Tocantins</option>
				</select>
				<button id="sign-up" type="submit" value="Cadastrar" class="btn-green">Cadastrar</button>
			</form>
		</div>
		<div class="form-container sign-in-container">
			<form action="#" class="info_login" id="form_login" method="post" onsubmit="return entrar()">
				<h1>Login</h1>
				<input id="emailEmpresa_login" type="email" name="emailEmpresa_login" placeholder="Email" />
				<input id="senhaEmpresa_login" type="password" name="senhaEmpresa_login" placeholder="Senha" />
				<button id="login" type="login" name="login">Entrar</button>
			</form>
		</div>
		<div class="overlay-container">
			<div class="overlay">
				<div class="overlay-panel overlay-left">
					<h1>Já é nosso usuário?</h1>
					<p>Faça login e usuflua dos nossos serviços</p>
					<button class="ghost" id="signIn">Entrar</button>
				</div>
				<div class="overlay-panel overlay-right">
					<h1>É novo por aqui?</h1>
					<p>Faça o seu cadastro e contrate nossos serviços de monitoramento.</p>
					<button class="ghost" id="signUp">Cadastre-se</button>
				</div>
			</div>
		</div>
	</div>

</body>

</html>

<script>
	const signUpButton = document.getElementById('signUp');
	const signInButton = document.getElementById('signIn');
	const container = document.getElementById('container');

	signUpButton.addEventListener('click', () => {
		container.classList.add("right-panel-active");
	});

	signInButton.addEventListener('click', () => {
		container.classList.remove("right-panel-active");
	});


	function cadastrar() {
		
		var formulario = new URLSearchParams(new FormData(form_cadastro));
		fetch("/usuarios/cadastrar", {
			method: "POST",
			body: formulario
		}).then(function (response) {



			if (response.ok) {

				swal('Cadastro realizado com sucesso!', "Faça o login para acessar nossa dashboard!", "success").then(() => {
					window.location.href = 'cadastro-user.html';

					sessionStorage.nome_usuario_meuapp = "Empresa."
					// sessionStorage.nome_usuario_meuapp = json.nomeUsuario;
				})
			} else {
				console.log('Erro de cadastro!');
				swal("Erro ao Cadastrar", "Por favor insira todas as informações corretamente e tente novamente", "error")
			}
		});

		return false;
	}

	function entrar() {
		var formulario = new URLSearchParams(new FormData(form_login));
		fetch("/equipe/autenticar", {
			method: "POST",
			body: formulario
		}).then(resposta => {

			if (resposta.ok) {

				resposta.json().then(json => {

					sessionStorage.login_usuario_meuapp = json.loginUsuario;
					sessionStorage.nome_usuario_meuapp = json.nomeUsuario;

					window.location.href = 'cadastro-user.html';
				});

			} else {

				console.log('Erro de login!');

				resposta.text().then(texto => {
					console.error(texto);
					finalizar_aguardar(texto);
				});
			}
		});

		return false;
	}


</script>