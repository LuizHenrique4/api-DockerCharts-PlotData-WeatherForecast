<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="css/cadastro.css">
    <link rel="shortcut icon" href="Logo.png">
    <link href='https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css' rel='stylesheet'>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Equipe - Overwatch</title>
</head>

<body onload="nome_usuario(), atualizacaoPeriodica()" style="overflow-y: scroll">
    <div class="sidebar">
        <div class="logo-content">
            <div class="logo">
                <img src="./img/logo-overwatch.png">
                <div class="nome_logo">Overwacth</div>
            </div>
            <i class='bx bx-menu' id="btn"></i>
        </div>
        <ul class="lista-nav">
            <li style="display: none;">
                <i class='bx bx-search-alt'></i>
            </li>
            <li href="./principal.html">
                <a href="./principal.html">
                    <i class='bx bxs-dashboard' href="./principal.html"></i>
                    <span class="links" href="./principal.html">Principal</span>
                </a>
                <span class="dica" href="./principal.html">Principal</span>
            </li>
            <li>
                <a href="./cadastro-user.html">
                    <i class='bx bx-chat' href="./cadastro-user"></i>
                    <span class="links" href="./cadastro-user.html">Usuários</span>
                </a>
                <span class="dica" href="./cadastro-user.html">Usuários</span>
            </li>
            <li>
                <a href="./pagina-admnistrador.html">
                    <i class='bx bx-user' href="./pagina-admnistrador.html"></i>
                    <span class="links" href="./pagina-admnistrador.html">Perfil</span>
                </a>
                <span class="dica" href="./pagina-admnistrador.html">Perfil</span>
            </li>
            <li href="./dashboard-ow.html">
                <a href="./dashboard-ow.html">
                    <i class='bx bx-pie-chart-alt-2' href="./dashboard-ow.html"></i>
                    <spam class="links" href="./dashboard-ow.html">Graficos</spam>
                </a>
                <spam class="dica" href="./dashboard-ow.html">Graficos</spam>
            </li>
            <li href="./historico-ow.html">
                <a href="./historico-ow.html">
                    <i class='bx bx-history' href="./historico-ow.html"></i>
                    <spam class="links" href="./historico-ow.html">Historico</spam>
                </a>
                <spam class="dica" href="./historico-ow.html">Historico</spam>
            </li>
        </ul>
        <div class="perfil-content">
            <div class="perfil">
                <div class="icone-perfil">
                    <img src="./img/logo-overwatch.png" alt="">
                    <div class="cargo">
                        <div id="nome_usuario_logado2" class="nome">Bruno Leonardo</div>
                        <div class="trabalho">Desenvolvedor</div>
                    </div>
                </div>
                <a href="#">
                    <i class='bx bx-log-out' id='logout' onclick="logoff()"></i>
                    <span class="links" onclick="logoff()"></span>
                </a>
            </div>
        </div>
    </div>
    <div class="home-content">
        <div class="header">
            <div class="header-content">
                <div class="container-name">
                    <div id="nome_usuario_logado" class="nome-empresa">Bem vindo, Bruno Leonardo</div>
                    <div class="ow">Cadastro de funcionarios</div>
                </div>
            </div>
        </div>
        <div class="divider">
            <div class="registration-form">
                <form action="#" class="ca-cadastro" id="form_btn_cadastro" method="post" onsubmit="return cadastrar()">
                    <h1>Cadastro da Equipe</h1>
                    <p class="name-title">Nome:</p>
                    <input type="text" id="nomeUsuario" name="nomeUsuario" />
                    <p class="email-title">E-mail:</p>
                    <input type="text" id="loginUsuario" name="loginUsuario" />
                    <p class="post-title">Cargo:</p>
                    <select name="tipoUsuario" type="text" id="tipoUsuario" name="tipoUsuario">
                        <option value="-">Selecione Cargo</option>
                        <option value="G">Gerente</option>
                        <option value="R">Analista</option>
                        <option value="F">Suporte</option>
                    </select>
                    <div class="password-input input-space">
                        <p class="password-title">Senha:</p>
                        <input type="password" type="password" id="senhaUsuario" name="senhaUsuario">
                    </div>
                    <div class="password-input">
                        <p class="confirmation-password-title">Confirmar sua Senha:</p>
                        <input type="password">
                    </div>
                    <button class="registration-button" value="Cadastrar" id="registration" type="submit">Cadastrar</button>
                </form>
            </div>
            <div class="registration-list">
                <div>
                    <h1>Lista de Usuarios</h1>
                    <!-- <div class="user" id="div_user">
                        <span class="name-user" id="nome_usuarios"></span>
                        <span class="name-user" id="nome_usuarios2"></span>
                        <span class="name-user" id="nome_usuarios3"></span>

                        <span class="name-user" id="nome_usuarioss"></span>
                        <span class="name-user" id="nome_usuarioss2"></span>
                        <span class="name-user" id="nome_usuarioss3"></span>

                        <span class="name-user" id="nome_usuariosss"></span>
                        <span class="name-user" id="nome_usuariosss2"></span>
                        <span class="name-user" id="nome_usuariosss3"></span>
                    </div> -->

                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</body>

</html>

<script>
    let btn = document.querySelector("#btn");
    let sidebar = document.querySelector(".sidebar");
    let searchBtn = document.querySelector(".bx-search-alt");

    btn.onclick = function () {
        sidebar.classList.toggle("active");
    }
    searchBtn.onclick = function () {
        sidebar.classList.toggle("active");
    }

    function nome_usuario() {
        if (sessionStorage.nome_usuario_meuapp == undefined) {
            window.location.href = 'loginecadastro.html';
        } else {
            var nome_usuario = sessionStorage.nome_usuario_meuapp;
            console.log(nome_usuario)
            nome_usuario_logado.innerHTML = `Bem-Vindo, ${nome_usuario}!`

            var nome_usuario2 = sessionStorage.nome_usuario_meuapp;
            console.log(nome_usuario2)
            nome_usuario_logado2.innerHTML = `${nome_usuario2}!`
        }
    }

    function cadastrar() {
        var formulario = new URLSearchParams(new FormData(form_btn_cadastro));
        fetch("/equipe/cadastrar", {
            method: "POST",
            body: formulario
        }).then(function (response) {

            if (response.ok) {

                swal('Cadastro realizado com sucesso!', "Faça o login para acessar nossa dashboard!", "success").then(() => {
                    window.location.href = 'cadastro-user.html';
                })


            } else {
                console.log('Erro de cadastro!');
                swal("Erro ao Cadastrar", "Por favor insira todas as informações corretamente e tente novamente", "error")
            }
        });

        return false;
    }
    function atualizacaoPeriodica() {
        obterdadosporservidor(1);
        obterdadosporservidor(2);
        obterdadosporservidor(3);
        // setTimeout(atualizacaoPeriodica, 2000);
        nome_usuario();
    }


    function obterdadosporservidor(fkCodigoServidor) {
        fetch(`/leituras/dashboard-ow/${fkCodigoServidor}`)
            .then(resposta => {

                if (resposta.ok) {
                    resposta.json().then(function (resposta) {

                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                        var dados = {
                            cpu: resposta.cpu,
                            memoriaRam: resposta.memoriaRam,
                            disco: resposta.disco
                        }

                        atualizarTela(dados, fkCodigoServidor);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados do servidor p/ gráfico: ${error.message}`);
            });
    }

    function atualizarTela(dados, fkCodigoServidor) {
        console.log('iniciando atualização da tela...');

        var div_cpu_alterar
        div_cpu_alterar = nome_usuarios
        div_cpu_alterar.innerHTML += `
        CPU: ${dados.cpu}%
        Memória Ram: ${dados.memoriaRam}%
        Disco: ${dados.disco}% <br>
        `;
    }

</script>